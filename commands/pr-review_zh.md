## PR评审

通过系统性的Pull Request评审确保代码质量和架构健全性。

### 使用方法

```bash
# PR的全面评审
gh pr view 123 --comments
「请从代码质量、安全性、架构的角度对这个PR进行系统性评审并提供反馈」

# 安全专项评审
gh pr diff 123
「请重点关注安全风险和漏洞进行评审」

# 架构角度评审
gh pr checkout 123 && find . -name "*.js" | head -10
「请从分层分离、依赖关系、SOLID原则的角度评估架构」
```

### 基本示例

```bash
# 代码质量的数值评估
find . -name "*.js" -exec wc -l {} + | sort -rn | head -5
"请评估代码复杂度、函数大小、重复度并指出改进点"

# 安全漏洞检查
grep -r "password\|secret\|token" . --include="*.js" | head -10
"请检查机密信息泄露、硬编码、认证绕过的风险"

# 检测架构违规
grep -r "import.*from.*\.\./\.\." . --include="*.js"
"请评估分层违规、循环依赖、耦合度问题"
```

### 评论分类体系

```
🔴 critical.must: 致命问题
├─ 安全漏洞
├─ 数据一致性问题
└─ 系统故障风险

🟡 high.imo: 高优先级改进
├─ 功能失效风险
├─ 性能问题
└─ 可维护性大幅降低

🟢 medium.imo: 中优先级改进
├─ 可读性提高
├─ 代码结构改善
└─ 测试质量提高

🟢 low.nits: 轻微指出
├─ 风格统一
├─ 拼写错误修正
└─ 添加注释

🔵 info.q: 问题/信息提供
├─ 确认实现意图
├─ 设计决策背景
└─ 最佳实践分享
```

### 评审观点

#### 1. 代码正确性

- **逻辑错误**: 边界值、Null检查、异常处理
- **数据一致性**: 类型安全、验证
- **错误处理**: 全面性、适当处理

#### 2. 安全性

- **认证授权**: 适当检查、权限管理
- **输入验证**: SQL注入、XSS对策
- **机密信息**: 禁止日志输出、加密

#### 3. 性能

- **算法**: 时间复杂度、内存效率
- **数据库**: N+1查询、索引优化
- **资源**: 内存泄漏、缓存利用

#### 4. 架构

- **分层分离**: 依赖方向、适当分离
- **耦合度**: 松耦合、接口利用
- **SOLID原则**: 单一责任、开放封闭、依赖倒置

### 评审流程

1. **事前确认**: PR信息、变更差异、相关Issue
2. **系统性检查**: 安全 → 正确性 → 性能 → 架构
3. **建设性反馈**: 具体改进方案和代码示例
4. **跟进**: 确认修复、CI状态、最终批准

### 有效评论示例

**安全问题**

```markdown
**critical.must.** 密码以明文形式保存

```javascript
// 修正方案
const bcrypt = require('bcrypt');
const hashedPassword = await bcrypt.hash(password, 12);
```

为防止安全风险，必须进行哈希处理。

```

**性能改进**
```markdown
**high.imo.** 存在N+1查询问题

```javascript
// 改进方案: 预加载
const users = await User.findAll({ include: [Post] });
```

可以大幅减少查询次数。

```

**架构违规**
```markdown
**high.must.** 存在分层违规

领域层直接依赖基础设施层。
请按照依赖倒置原则引入接口。
```

### 注意事项

- **建设性语气**: 协作而非攻击性的沟通
- **具体建议**: 不仅指出问题，还提供解决方案
- **优先级排序**: 按Critical → High → Medium → Low顺序处理
- **持续改进**: 将评审结果纳入知识库
```