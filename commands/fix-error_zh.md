## 错误修复

从错误消息中识别根本原因，并提出经过验证的解决方案。

### 使用方法

```bash
/fix-error [选项]
```

### 选项

- 无 : 标准错误分析
- `--deep` : 深度分析模式（包括依赖关系和环境因素）
- `--preventive` : 重视预防措施的分析
- `--quick` : 仅提示可立即应用的修复

### 基本示例

```bash
# 标准错误分析
npm run build 2>&1
/fix-error
「分析构建错误并提出修复方法」

# 深度分析模式
python app.py 2>&1
/fix-error --deep
「分析错误的根本原因，包括环境因素」

# 重视立即修复
cargo test 2>&1
/fix-error --quick
「提出可立即应用的修复方法」

# 重视预防措施
./app 2>&1 | tail -50
/fix-error --preventive
「提出错误修复和今后的预防措施」
```

### 与 Claude 协作

```bash
# 分析错误日志
cat error.log
/fix-error
「识别错误的根本原因并提出修复方法」

# 解决测试失败
npm test 2>&1
/fix-error --quick
「分析失败的测试并提出可立即应用的修复方案」

# 解析堆栈跟踪
python script.py 2>&1
/fix-error --deep
「从这个堆栈跟踪中识别问题位置，包括环境因素」

# 批量解决多个错误
grep -E "ERROR|WARN" app.log | tail -20
/fix-error
「按优先级分类这些错误和警告，并为每个提出解决方案」
```

### 错误分析的优先级

#### 🔴 紧急度: 高（必须立即处理）

- **应用程序停止**: 崩溃、无限循环、死锁
- **数据丢失风险**: 数据库错误、文件损坏
- **安全漏洞**: 认证失败、权限错误、注入
- **生产环境影响**: 部署失败、服务停止

#### 🟡 紧急度: 中（建议早期处理）

- **性能问题**: 内存泄漏、延迟、超时
- **部分功能故障**: 特定功能错误、UI 缺陷
- **开发效率下降**: 构建错误、测试失败

#### 🟢 紧急度: 低（可计划处理）

- **警告消息**: 弃用通知、lint 错误
- **仅限开发环境**: 仅本地环境问题
- **未来风险**: 技术债务、可维护性问题

### 分析流程

#### 阶段 1: 错误信息收集

```bash
🔴 必须执行:
- 获取完整的错误消息
- 确认堆栈跟踪
- 确定发生条件（可重现性）

🟡 早期执行:
- 收集环境信息（OS、版本、依赖关系）
- 最近的变更历史（git log、最近的提交）
- 确认相关日志

🟢 附加执行:
- 系统资源状况
- 网络状态
- 外部服务状态
```

#### 阶段 2: 根本原因分析

1. **整理表面症状**
   - 错误消息的确切内容
   - 发生时间和模式
   - 确定影响范围

2. **识别深层原因**
   - 应用 5 Whys 分析
   - 跟踪依赖关系
   - 确认环境差异

3. **验证假设**
   - 创建最小重现代码
   - 执行分离测试
   - 缩小原因范围

#### 阶段 3: 解决方案实施

```bash
🔴 立即处理（热修复）:
- 抑制症状的最小修复
- 应用临时回避措施
- 准备紧急部署

🟡 根本解决:
- 针对原因的本质修复
- 添加测试用例
- 更新文档

🟢 实施预防措施:
- 加强错误处理
- 设置监控和警报
- 改进 CI/CD 管道
```

### 输出示例

```
🚨 错误分析报告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📍 错误概述
├─ 类型: [编译/运行时/逻辑/环境]
├─ 紧急度: 🔴 高 / 🟡 中 / 🟢 低
├─ 影响范围: [功能名/组件]
└─ 可重现性: [100% / 间歇性 / 特定条件]

🔍 根本原因
├─ 直接原因: [具体原因]
├─ 背景因素: [环境/设置/依赖关系]
└─ 触发因素: [发生条件]

💡 解决方案
🔴 立即处理:
1. [具体的修复命令/代码]
2. [临时回避措施]

🟡 根本解决:
1. [本质修复方法]
2. [必要的重构]

🟢 预防措施:
1. [错误处理改进]
2. [添加测试]
3. [监控设置]

📝 验证步骤
1. [修复应用后的确认方法]
2. [测试执行命令]
3. [功能验证项目]
```

### 按错误类型的分析方法

#### 编译/构建错误

```bash
# TypeScript 类型错误
必须确认（高）:
- tsconfig.json 设置
- 类型定义文件（.d.ts）存在性
- import 语句的准确性

# Rust 生命周期错误
必须确认（高）:
- 所有权移动
- 引用的有效期
- 可变性冲突
```

#### 运行时错误

```